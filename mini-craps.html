<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Mini-Craps (PyScript)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- External stylesheet -->
  <link rel="stylesheet" href="mini-craps.css">

  <!-- Pinned PyScript version (stable). DO NOT change to 'latest'. -->
  <link rel="stylesheet" href="https://pyscript.net/releases/2024.6.1/pyscript.css" />
  <script defer src="https://pyscript.net/releases/2024.6.1/pyscript.js"></script>

  <!-- Tiny diagnostic: if you open DevTools, you should see this log after load -->
  <script>
    window.addEventListener('load', () => {
      if (window.pyscript) console.log('PyScript loaded OK');
      else console.warn('PyScript NOT loaded â€” if you see Python printed below, refresh or check blockers.');
    });
  </script>
</head>

<body>
  <div class="wrap">
    <h1>Mini-Craps</h1>
    <div class="rules">
      <div>Step right up, gentlemen â€” Mini-Craps awaits. Fortune favours the bold!</div>
      <div>Type ROLL to play, or QUIT to leave the table.</div>
      <div>Rules: 7 or 11 = win, 2/3/12 = lose, 4/5/6/8/9/10 = keep rolling.</div>
    </div>

    <div class="box">
      <div id="output" class="msg">Press ROLL to begin.</div>
      <div id="dice" class="dice"></div>
      <div id="total" class="total"></div>
    </div>

    <div class="btns">
      <button id="rollBtn" py-click="on_roll" class="roll">ROLL</button>
      <button id="quitBtn" py-click="on_quit" class="quit">QUIT</button>
      <button id="retryBtn" py-click="on_retry" class="retry" style="display:none">ROLL AGAIN</button>
    </div>

    <div class="footer">
      <div id="rounds">Total rounds played: 0</div>
      <a href="#" target="_blank" rel="noopener">ðŸŽ² Play Live Game</a>
    </div>
  </div>

  <!-- PyScript logic -->
  <py-script>
from pyscript import when, document
import random

# ---- Elements ----
out = document.getElementById("output")
dice_el = document.getElementById("dice")
total_el = document.getElementById("total")
rounds_el = document.getElementById("rounds")
btn_retry = document.getElementById("retryBtn")
btn_roll = document.getElementById("rollBtn")

# ---- Game state ----
rounds = 0
game_over = False

def reset_ui():
    btn_roll.disabled = False
    btn_retry.style.display = "none"
    out.textContent = "Press ROLL to begin."
    dice_el.textContent = ""
    total_el.textContent = ""
    rounds_el.textContent = "Total rounds played: 0"

reset_ui()

def show_roll(d1, d2, total):
    dice_el.textContent = f"You rolled: {d1} and {d2} - total {total}"
    rounds_el.textContent = f"Total rounds played: {rounds}"

def show_message(msg):
    out.textContent = msg

def show_loss():
    lines = [
        "Craps! Unlucky roll, sir - perhaps next time fortune will turn.",
        "Craps! Misfortune this round, shooter - the house claims the win.",
        "Craps! A gentleman's loss - better luck on the next throw."
    ]
    show_message(random.choice(lines))
    btn_retry.style.display = "inline-block"
    btn_roll.disabled = True

@when("click", "#rollBtn")
def on_roll(event):
    global rounds, game_over
    if game_over:
        return
    rounds += 1
    d1 = random.randint(1, 6)
    d2 = random.randint(1, 6)
    total = d1 + d2
    show_roll(d1, d2, total)

    if total in (7, 11):
        if total == 7:
            show_message("Seven - lucky roll, shooter! The house salutes your win.")
        else:
            show_message("Eleven - a natural! Fine roll, shooter, that's a win!")
        game_over = True
        btn_roll.disabled = True
        btn_retry.style.display = "none"
        return

    if total in (2, 3, 12):
        show_loss()
        return

    if total == 10:
        show_message("A fine 10, sir - the point is set. Let's see if fortune favors your hand.")
    elif total == 6 and d1 == d2:
        show_message("Point is six - shooter keeps the dice. Keep rolling!")
    else:
        show_message("Neutral roll - you're still in play, keep rolling!")
    btn_retry.style.display = "none"

@when("click", "#retryBtn")
def on_retry(event):
    global game_over
    game_over = False
    btn_roll.disabled = False
    btn_retry.style.display = "none"
    show_message("Press ROLL to begin.")
    dice_el.textContent = ""
    total_el.textContent = ""

@when("click", "#quitBtn")
def on_quit(event):
    global game_over
    show_message("Thanks for playing!")
    game_over = True
    btn_roll.disabled = True
    btn_retry.style.display = "none"
  </py-script>
</body>
</html>
