<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Mini-Craps (PyScript)</title>

  <!-- ✅ Use a fixed PyScript release instead of "latest" -->
  <link rel="stylesheet" href="https://pyscript.net/releases/2024.6.1/core.css" />
  <script type="module" src="https://pyscript.net/releases/2024.6.1/core.js"></script>

  <style>
    body{font-family:system-ui,Arial,sans-serif;max-width:720px;margin:40px auto;padding:0 16px;line-height:1.5}
    h1{margin-bottom:8px}
    .rules{color:#444;margin-top:0}
    .card{border:1px solid #ddd;border-radius:10px;padding:16px;margin-top:16px}
    .row{display:flex;gap:10px;margin-top:10px}
    button{padding:10px 16px;border-radius:8px;border:1px solid #444;background:#111;color:#fff;cursor:pointer}
    button[disabled]{opacity:.5;cursor:not-allowed}
    pre{white-space:pre-wrap;min-height:180px}
  </style>
</head>
<body>
  <h1>Mini-Craps</h1>
  <p class="rules">
    Step right up, gentlemen — Mini-Craps awaits. Fortune favours the bold!<br>
    Click ROLL to play, or QUIT to leave the table.<br>
    Rules: 7 or 11 = win, 2/3/12 = lose, 4/5/6/8/9/10 = keep rolling.
  </p>

  <div class="card">
    <div class="row">
      <button id="rollBtn">ROLL</button>
      <button id="quitBtn">QUIT</button>
    </div>
    <pre id="out" class="card"></pre>
    <div id="rounds" style="margin-top:8px;color:#555;"></div>
  </div>

  <!-- ✅ Explicitly tell browser this is Python code -->
  <script type="text/python">
from js import document
import random

out = document.getElementById("out")
rounds_el = document.getElementById("rounds")
roll_btn = document.getElementById("rollBtn")
quit_btn = document.getElementById("quitBtn")

rounds = 0
game_over = False

def write(msg):
    out.textContent += msg + "\n"

def set_rounds():
    rounds_el.textContent = f"Total rounds played: {rounds}"

def end_game(extra=None):
    global game_over
    game_over = True
    if extra:
        write(extra)
    set_rounds()
    roll_btn.disabled = True

def on_roll(evt=None):
    global rounds, game_over
    if game_over:
        return

    rounds += 1
    d1 = random.randint(1, 6)
    d2 = random.randint(1, 6)
    total = d1 + d2

    write("\n----------------------------")
    write(f"You rolled: {d1} and {d2} - total {total}")

    # Win: 7 or 11
    if total == 7:
        write("Seven - lucky roll, shooter! The house salutes your win.")
        if rounds == 3:
            write("Three rounds complete — thanks for playing!")
        end_game()
        return
    elif total == 11:
        write("Eleven - a natural! Fine roll, shooter, that's a win!")
        if rounds == 3:
            write("Three rounds complete — thanks for playing!")
        end_game()
        return

    # Lose: 2, 3, 12
    if total in (2, 3, 12):
        loss_lines = [
            "Craps! Unlucky roll, sir - perhaps next time fortune will turn.",
            "Craps! Misfortune this round, shooter - the house claims the win.",
            "Craps! A gentleman's loss - better luck on the next throw."
        ]
        write(random.choice(loss_lines))
        if rounds == 3:
            write("Three rounds complete — thanks for playing!")
            end_game()
            return
        write("Would you like to ROLL again or QUIT?")
        set_rounds()
        return

    # Neutral totals
    if total == 10:
        write("A fine 10, sir - the point is set. Let's see if fortune favors your hand.")
    elif total == 6 and d1 == d2:
        write("Point is six - shooter keeps the dice. Keep rolling!")
    else:
        write("Neutral roll - you're still in play, keep rolling!")
    write("----------------------------")

    if rounds == 3:
        write("Three rounds complete — thanks for playing!")
        end_game()
        return

    set_rounds()

def on_quit(evt=None):
    write("Thanks for playing!")
    end_game()

roll_btn.addEventListener("click", on_roll)
quit_btn.addEventListener("click", on_quit)

set_rounds()
write("Click ROLL to begin, or QUIT to leave the table.")
  </script>
</body>
</html>
